version: "1"

package:
  id: com.qq.weixin.work.deepin
  name: com.qq.weixin.work.deepin
  version: 4.1.22.6009
  kind: app
  description: |
    convert from 4.1.22.6009deepin14    Tencent WXWork Client on Deepin Wine

base: org.deepin.base.wine
runtime: org.deepin.runtime.wine

command:
  - /opt/apps/com.qq.weixin.work.deepin/files/run.sh

sources:
  - kind: file
    url: https://aptly.uniontech.com/pkg/nonfree-eagle/release-candidate/d2luZTgtcnVudGltZTIyMDI0LTA5LTAzIDEzOjE1OjAx/pool/non-free/c/com.qq.weixin.work.deepin/com.qq.weixin.work.deepin_4.1.22.6009deepin14_amd64.deb
    digest: 478a89e36ed3356eb6ef3180f45ccbb57e39db8aae862d70210837c377eab0e7

build: |
  set -x
  SOURCES="linglong/sources"
  dpkg-deb -x $SOURCES/com.qq.weixin.work.deepin_4.1.22.6009deepin14_amd64.deb $SOURCES/com.qq.weixin.work.deepin
  # run.sh替换
  FILE_PATH="$SOURCES/com.qq.weixin.work.deepin/opt/apps/com.qq.weixin.work.deepin/files/run.sh" 
  sed -i -e 's|/opt/deepin-wine8-stable|/runtime/deepin-wine8-stable|g' \
         -e 's|/opt/deepin-wine6-stable|/runtime/deepin-wine6-stable|g' \
         -e 's|/opt/deepinwine|/runtime/deepinwine|g' \
         -e 's|/opt/deepin-box86|/runtime/deepin-box86|g' \
         -e 's|BOTTLEPATH="$HOME/.deepinwine/$BOTTLENAME"|BOTTLEPATH="$HOME/.linglong/$BOTTLENAME"|g' "$FILE_PATH"
  
  
  # 遍历数组中的每个文件路径  
  for file in "${files_to_delete[@]}"; do  
      # 检查文件是否存在  
      if [ -f "$file" ]; then   
          rm -rf "$file"  
          if [ $? -eq 0 ]; then  
              echo "$file deleted successfully."  
          else  
              echo "Failed to delete $file."  
          fi  
      else  
          echo "$file does not exist."  
      fi  
  done
  install -d $PREFIX/share
  install -d $PREFIX/bin
  # move files
  cp -r $SOURCES/com.qq.weixin.work.deepin/opt/apps/com.qq.weixin.work.deepin/entries/* $PREFIX/share
  cp -r $SOURCES/com.qq.weixin.work.deepin/opt/apps/com.qq.weixin.work.deepin/files/* $PREFIX
  
